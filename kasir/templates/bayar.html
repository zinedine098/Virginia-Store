{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-3">
  <h4>ðŸ’³ Pembayaran</h4>
  <div class="row">
    <div class="col-md-6">
      <h5>Keranjang Belanja</h5>
      <table class="table table-bordered">
        <thead><tr><th>Barang</th><th>Jumlah</th><th>Harga</th><th>Subtotal</th></tr></thead>
        <tbody>
          {% for detail in details %}
          <tr>
            <td>{{ detail.produk.nama_barang }}</td>
            <td>{{ detail.jumlah }}</td>
            <td>Rp {{ detail.produk.harga_barang|floatformat:0 }}</td>
            <td>Rp {{ detail.subtotal|floatformat:0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3">Total</th>
            <th>Rp {{ total|floatformat:0 }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
    <div class="col-md-6">
      <form method="post" action="{% url 'proses_bayar' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="customer" class="form-label">Pelanggan</label>
          <select class="form-control" id="customer" name="customer">
            <option value="">Umum</option>
            {% for customer in customers %}
            <option value="{{ customer.id }}">{{ customer.nama }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label for="payment_method" class="form-label">Metode Pembayaran</label>
          <select class="form-control" id="payment_method" name="payment_method" required>
            <option value="cash">Cash</option>
            <option value="card">Card</option>
            <option value="transfer">Transfer</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="total" class="form-label">Total</label>
          <input type="number" class="form-control" id="total" name="total" value="{{ total }}" readonly>
        </div>
        <div class="mb-3">
          <label for="amount_paid" class="form-label">Dibayar</label>
          <input type="number" class="form-control" id="amount_paid" name="amount_paid" step="0.01" required>
        </div>
        <div class="mb-3">
          <label for="change" class="form-label">Kembalian</label>
          <input type="number" class="form-control" id="change" name="change" readonly>
        </div>
        <button type="submit" class="btn btn-success">Bayar</button>
        <a href="{% url 'halaman_kasir' %}" class="btn btn-secondary">Kembali</a>
      </form>
    </div>
  </div>
</div>

<script>
document.getElementById('amount_paid').addEventListener('input', function() {
  const total = parseFloat(document.getElementById('total').value) || 0;
  const paid = parseFloat(this.value) || 0;
  const change = paid - total;
  document.getElementById('change').value = change.toFixed(2);
});
</script>
{% endblock %}
